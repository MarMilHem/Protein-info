<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Protein Info</title>

  <style>
    /* Layout */
    :root {
      --page-max: 1100px;
    }
    body {
      font-family: system-ui, sans-serif;
      background: #f7f9fc;
      color: #222;
      margin: 0;
    }
    .page {
      max-width: var(--page-max);
      margin: 0 auto;
      padding: 2rem 1.25rem 3rem;
    }

    /* Hero */
    .title-box {
      background: #e6f3ff;
      border-radius: 20px;
      padding: 2rem 3rem;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
      display: inline-block;
      margin-bottom: 1.25rem;
    }
    h1 {
      margin: 0;
      font-size: 2.5rem;
      color: #0059ff;
      text-align: center;
    }
    p.lead, p.note {
      max-width: 720px;
      margin: 0.75rem auto;
      line-height: 1.6;
      color: #333;
      text-align: center;
    }

    /* Search */
    .search-bar {
      margin: 2rem auto 0;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
    }
    .search-bar input {
      padding: 0.75rem 1rem;
      font-size: 1rem;
      border: 1px solid #ccc;
      border-radius: 999px;
      width: 320px;
      outline: none;
      transition: border-color 0.2s, box-shadow 0.2s;
      background: #fff;
    }
    .search-bar input:focus {
      border-color: #0059ff;
      box-shadow: 0 0 6px rgba(0, 89, 255, 0.3);
    }
    .search-bar button {
      background-color: #0059ff;
      color: white;
      border: none;
      border-radius: 999px;
      padding: 0.75rem 1.5rem;
      font-size: 1rem;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .search-bar button:hover { background-color: #0040cc; }

    /* Results */
    #brandResults {
      max-width: 800px;
      margin: 2rem auto;
    }
    .result {
      padding: 1rem;
      border: 1px solid #eee;
      border-radius: .8rem;
      margin: .75rem 0;
      background: #fff;
    }
    .result a {
      font-weight: 600;
      text-decoration: none;
      color: #0059ff;
    }
    .result small {
      display:block; font-size:.9rem; color:#666; margin:.25rem 0;
      word-break: break-all;
    }

    footer {
      margin-top: 3rem;
      font-size: 0.9rem;
      color: #777;
      text-align: center;
    }
  </style>

  <!-- comparison table styles -->
  <link rel="stylesheet" href="assets/css/compare.css" />
</head>

<body>
  <main class="page">
    <header class="hero" aria-label="Intro">
      <div class="title-box">
        <h1>Welcome to Protein Info</h1>
      </div>
      <p class="lead">
        Explore and compare protein brands ‚Äî prices, macros, and nutritional profiles ‚Äî all in one spot.
      </p>
      <p class="note">üöß Under development ‚Äî more features coming soon!</p>
    </header>

    <!-- üîç Search Bar -->
    <form id="brandSearchForm" class="search-bar" action="/search" method="get">
      <input type="text" name="q" placeholder="Search for a protein brand..." required />
      <button type="submit">Search</button>
    </form>

    <div id="brandResults" aria-live="polite"></div>

    <!-- üî¢ Comparison Table -->
    <section id="compare-section" style="margin:24px 0;">
      <div id="compare-wrap">
        <div id="compare-head">
          <h2>Compare products <span class="chip" id="compare-count">0</span></h2>
          <div class="toolbar">
            <label class="toggle"><input type="checkbox" id="veganOnly"><span>Vegan only</span></label>
            <label class="toggle">
              <span class="hide-sm">Type</span>
              <select id="typeFilter">
                <option value="">All types</option>
                <option>Whey</option><option>Isolate</option><option>Casein</option><option>Vegan</option><option>Egg</option>
              </select>
            </label>
            <label class="toggle"><input type="checkbox" id="toggleExtended"><span>Show extended columns</span></label>
            <button class="btn" id="clearBtn" type="button">Clear</button>
            <button class="btn" id="shareBtn" type="button">Share link</button>
            <button class="btn btn-primary" id="loadExamplesBtn" type="button">Load demo</button>
          </div>
        </div>

        <div class="table-wrap">
          <table class="compare" id="compareTable" aria-label="Protein comparison table">
            <thead>
              <tr>
                <th data-key="brand">Brand</th>
                <th data-key="product">Product</th>
                <th class="hide-md" data-key="type">Type</th>
                <th class="num" data-key="pricePerKg">Price / kg</th>
                <th class="num hide-md" data-key="servingSizeG">Serving (g)</th>
                <th class="num" data-key="pricePerServing">Price / serving</th>
                <th class="num" data-key="proteinPer100g">Protein / 100g</th>
                <th class="num" data-key="proteinPerServing">Protein / serving</th>
                <th class="num hide-md ext" data-key="caloriesPerServing">Calories / serving</th>
                <th class="num hide-md ext" data-key="carbsPerServing">Carbs / serving</th>
                <th class="num hide-md ext" data-key="fatPerServing">Fat / serving</th>
                <th class="hide-md ext" data-key="sweeteners">Sweeteners</th>
                <th class="hide-md ext" data-key="allergens">Allergens</th>
                <th class="hide-md ext" data-key="origin">Origin</th>
                <th class="num hide-md ext" data-key="rating">Rating</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="compareBody"></tbody>
          </table>
        </div>

        <div id="compare-empty">No items yet. Use your search results‚Äô ‚ÄúAdd to compare‚Äù to begin.</div>
      </div>
    </section>

    <footer>&copy; 2025 Protein Info. All rights reserved.</footer>
  </main>

  <!-- SEARCH ENGINE LOGIC -->
  <script>
    const formEl = document.getElementById('brandSearchForm');
    const resultsEl = document.getElementById('brandResults');

    formEl.addEventListener('submit', async (e) => {
      e.preventDefault();
      const query = formEl.q.value.trim();
      if (!query) return;

      resultsEl.textContent = "üîç Searching...";

      try {
        const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
        const data = await res.json();
        if (!res.ok) throw new Error(data.error || "Search failed");

        if (!data.results?.length) {
          resultsEl.textContent = "No protein brands found.";
          return;
        }

        resultsEl.innerHTML = data.results.map(r => `
          <article class="result">
            <a href="${r.url}" rel="noopener">${r.name}</a>
            <small>${r.displayUrl || r.url}</small>
            <p style="margin:.5rem 0 0;line-height:1.5;">${r.snippet || ""}</p>

            <!-- Example: wire an Add to Compare button if you have the needed fields -->
            ${r.id ? `<button style="margin-top:.5rem" onclick='Compare.add(${JSON.stringify({
              id: r.id,
              brand: r.brand || r.name || "Unknown",
              product: r.product || r.name || "Product",
              type: r.type || "",
              pricePerKg: r.pricePerKg || "",
              servingSizeG: r.servingSizeG || "",
              proteinPer100g: r.proteinPer100g || ""
            })})'>Add to Compare</button>` : ""}
          </article>
        `).join('');
      } catch (err) {
        resultsEl.innerHTML = `<span style="color:red;">‚ùå ${err.message}</span>`;
      }
    });
  </script>

  <!-- comparison logic -->
  <script src="assets/js/compare.js" defer></script>
</body>
</html>
