<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Protein Info</title>

  <style>
  :root {
    --page-max: 1100px;
  }

  body {
    font-family: system-ui, sans-serif;
    background: #f7f9fc;
    color: #222;
    margin: 0;
  }

  .page {
    max-width: var(--page-max);
    margin: 0 auto;
    padding: 2rem 1.25rem 3rem;
  }

  /* Centered title box */
  .hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 1.5rem;
  }

  .title-box {
    background: #e6f3ff;
    border-radius: 20px;
    padding: 2rem 3rem;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
    display: inline-block;
    margin-bottom: 1rem;
  }

  h1 {
    margin: 0;
    font-size: 2.5rem;
    color: #0059ff;
  }

  p.lead,
  p.note {
    max-width: 720px;
    margin: 0.75rem auto;
    line-height: 1.6;
    color: #333;
    text-align: center;
  }

  /* Search bar */
  .search-bar {
    margin: 2rem auto 0;
    display: flex;
    justify-content: center;
    gap: 0.5rem;
  }

  .search-bar input {
    padding: 0.75rem 1rem;
    font-size: 1rem;
    border: 1px solid #ccc;
    border-radius: 999px;
    width: 320px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    background: #fff;
  }

  .search-bar input:focus {
    border-color: #0059ff;
    box-shadow: 0 0 6px rgba(0, 89, 255, 0.3);
  }

  .search-bar button {
    background-color: #0059ff;
    color: white;
    border: none;
    border-radius: 999px;
    padding: 0.75rem 1.5rem;
    font-size: 1rem;
    cursor: pointer;
    transition: background-color 0.2s;
  }

  .search-bar button:hover {
    background-color: #0040cc;
  }

  #brandResults {
    max-width: 800px;
    margin: 2rem auto;
  }

  footer {
    margin-top: 3rem;
    font-size: 0.9rem;
    color: #777;
    text-align: center;
  }
</style>


  <!-- comparison table styles -->
  <link rel="stylesheet" href="assets/css/compare.css" />
</head>

<body>
  <main class="page">
    <header class="hero" aria-label="Intro">
      <div class="title-box">
        <h1>Welcome to Protein Info</h1>
      </div>
      <p class="lead">
        Explore and compare protein brands ‚Äî prices, macros, and nutritional profiles ‚Äî all in one spot.
      </p>
      <p class="note">üöß Under development ‚Äî more features coming soon!</p>
    </header>

    <!-- üîç Search Bar -->
    <form id="brandSearchForm" class="search-bar" action="/search" method="get">
      <input type="text" name="q" placeholder="Search for a protein brand..." required />
      <button type="submit">Search</button>
    </form>

    <div id="brandResults" aria-live="polite"></div>
    
    <!-- üìã Browse All Proteins -->
<section id="browse-all" style="margin:28px 0;">
  <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
    <h2 style="margin:0;">All available proteins</h2>
    <div style="display:flex;gap:8px;align-items:center;">
      <input id="allFilter" type="text" placeholder="Filter by brand/product‚Ä¶" 
             style="padding:.5rem .75rem;border:1px solid #e5e7eb;border-radius:10px;min-width:240px;">
      <select id="typeSelect" style="padding:.5rem .75rem;border:1px solid #e5e7eb;border-radius:10px;">
        <option value="">All types</option>
        <option>Whey</option><option>Isolate</option><option>Vegan</option><option>Casein</option><option>Egg</option>
      </select>
      <button id="reloadAllBtn" class="btn" type="button">Reload</button>
    </div>
  </div>
  <div id="allList" style="margin-top:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(260px,1fr));gap:12px;"></div>
</section>

    <!-- üî¢ Comparison Table -->
    <section id="compare-section" style="margin:24px 0;">
  <div id="compare-wrap">
    <div id="compare-head">
      <h2>Compare products <span class="chip" id="compare-count">0</span></h2>
      <div class="toolbar">
        <!-- kept simple on purpose; remove extra toggles -->
        <button class="btn" id="clearBtn" type="button">Clear</button>
        <button class="btn" id="shareBtn" type="button">Share link</button>
        <button class="btn btn-primary" id="loadExamplesBtn" type="button">Load demo</button>
      </div>
    </div>

    <div class="table-wrap">
      <table class="compare" id="compareTable" aria-label="Protein comparison table">
        <thead>
          <tr>
            <th data-key="brand">Brand</th>
            <th data-key="product">Product</th>
            <th class="num" data-key="servingSizeG">Serving (g)</th>
            <th class="num" data-key="pricePerServing">Price / serving</th>
            <th class="num" data-key="proteinPerServing">Protein / serving</th>
            <th class="num" data-key="caloriesPerServing">Calories / serving</th>
            <th class="num" data-key="carbsPerServing">Carbs / serving</th>
            <th class="num" data-key="fatPerServing">Fat / serving</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="compareBody"></tbody>
      </table>
    </div>

    <div id="compare-empty">No items yet. Use your search results‚Äô ‚ÄúAdd to compare‚Äù to begin.</div>
  </div>
</section>


    <footer>&copy; 2025 Protein Info. All rights reserved.</footer>
  </main>

  <!-- SEARCH LOGIC: fetches product data from /functions/search.js -->
<script>
  const formEl = document.getElementById('brandSearchForm');
  const resultsEl = document.getElementById('brandResults');

  formEl.addEventListener('submit', async (e) => {
    e.preventDefault();
    const query = formEl.q.value.trim();
    resultsEl.textContent = "üîç Searching...";

    try {
      const res = await fetch(`/search?q=${encodeURIComponent(query)}`);
      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Search failed");

      const items = data.results || [];
      if (!items.length) {
        resultsEl.textContent = "No matching protein brands.";
        return;
      }

      // Render results as simple brand cards
      resultsEl.innerHTML = items.map(p => `
        <article class="result">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:8px;flex-wrap:wrap;">
            <div>
              <div style="font-weight:700;">${p.brand}</div>
              <div>${p.product}</div>
              <div style="font-size:.9rem;color:#666;">${p.type || ""}</div>
            </div>
            <button class="btn" style="padding:.5rem .8rem;border:1px solid #e5e7eb;border-radius:10px;cursor:pointer"
              onclick='Compare.add(${JSON.stringify(p)})'>
              + Add to compare
            </button>
          </div>
          <div style="margin-top:.5rem;font-size:.9rem;color:#444;">
            <strong>Serving:</strong> ${p.servingSizeG ?? "‚Äî"} g ¬∑
            <strong>Protein/100g:</strong> ${p.proteinPer100g ?? "‚Äî"} g ¬∑
            <strong>Price/kg:</strong> ${p.pricePerKg != null ? "‚Ç¨"+p.pricePerKg.toFixed(2) : "‚Äî"}
          </div>
        </article>
      `).join('');
    } catch (err) {
      resultsEl.innerHTML = `<span style="color:red;">‚ùå ${err.message}</span>`;
    }
  });
</script>


  <!-- comparison logic -->
  <script src="assets/js/compare.js" defer></script>
</body>
</html>
